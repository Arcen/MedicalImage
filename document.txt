仕様書

ctImage CT画像保存
ctSlice CTスライス情報保存
region<int16> 領域データ
teacherPattern 教師パターン
miDocument ドキュメントデータ
miView ドキュメント表示用

前処理として空気領域でのCT値の補正

whiteTexture,blackTextureのリーク修正
クリックメニューのリーク修正
ファイルを開く際の、dcm有線

openmpサポートを入れてみる


対応リスト
・４箇所のメモリーリークを修正しました。終了時にクラッシュする現象が出ていましたが、修正されました。
・要望１：初期の設定色
		　初期の色は半透明で、色はランダムに設定するようにしました。
　　　　　設定自体はレジストリにあるのですが、Windows7の64bitでは場所が調整されてしまっているようで、
　　　　　レジストリファイルのインストールではうまくいかないようです。
　　　　　後で、対処します。
・要望２：小さな領域の削除
		「現在のスライスより上の小さい肺野領域削除」はスライス番号が大きな方向への処理になっていました。
			修正しました。
		初期読み込みの場合に気管支を削除する処理では、正常処理になっていました。
		・左右の情報は腹臥位を見ずに、画面上での左右になっています。
			情報出力時に左右毎の情報は出力していないように思えますので、ほぼ大丈夫だと思われます。
		・また、表示したときに台は必ず下に見える画像だけが対象になっています。
			上に台座が見えて、うつ伏せになっている場合には仰向けと設定する必要があります。
			これは、人体部分の検出処理にもかかわってきます。
		・相関を計算する箇所では、正常に処理が行われていることを確認しました。
・要望３：リスケール情報
		リスケール切片・傾斜には対応しました。
		ルックアップテーブルの方式もあるようですが、そちらには対応できていません。

・要望４：サンプルの保管場所
		ローカル・一つ上・指定位置・自動での読み込み・保存をそれぞれする・しない等の設定ではいかがでしょうか。
		とりあえず、こちらで再現しませんでしたので、閉じる前に保存をするか確認するようにしました。
		
・要望５：面積は平方センチメートルです。体積は立法センチメートル・ｃｃです。
		DICOM内の画素間隔とスライス位置から計算しています。

		但し、画像の「スライス位置」は、スライスが読み込まれたときに取得していましたので、
		一度読み込み終わらない限り、表示がおかしくなっていたようです。
		修正しましたが、読み込みに時間が掛かるようになりました。
		
		slice.dataがある場合には、ヘッダにある情報で処理していましたので、この現象はありません。
		
		dcmファイルから読み込んだ際に、画素間隔が読めていませんでした。
		表示上で画素間隔が0.625で横幅が512の場合、0.625*512=320となる箇所が1に設定されていました。
		1/512が画素間隔になるので、横幅x画素間隔の2乗分面積と体積が少なく表示していました。
		
		現時点では、出力情報はすべて画素で出しています。

・要望６：幾つかの処理の並列化なら、可能です。
		ファイルの読み込みとメモリ不足の際の自動開放処理との競合を検証してから、
		openmpで並列化にしてみようと思います。
		全体的には難しいので、重い処理を重点的に対処して行こうと思っています。

・要望７：引数で開くことに対応しました。
		複数シリーズがある場合の処理が動きますので、読み飛ばすスライス間隔を指定するダイアログが表示されます。
		引数すべてをファイル名として扱ってしまっていますので、複数の引数には対応していません。
		
		使用方法は、slice.dataかDICOMDIRファイル、もしくはdcmファイルがあるならそのディレクトリ内の何かのファイルを
		プログラムにドロップしてもらっても、起動します。
		

変更点：並列化対応
	相関処理（スライス単位）
	スレッドがブロックされる上に、プログレスバーが表示されない。
	別スレッドで動かさないと結局だめらしい。
	スレッド管理を作って、プールから処理を動かす。
	

ＴＯＤＯ
	SAX対応にしないと、大きな領域の読み込みが遅すぎる
